<!-- ====================  CONNECT4.HTML  ==================== -->
<section id="connect4">
  <h2>Connectâ€¯4</h2>

  <div class="connect4-game">
    <!-- The board will be generated by JavaScript -->
    <div class="board"></div>

    <p class="message"></p>      <!-- turn / result message -->
    <button class="reset">Restart Game</button>
  </div>
</section>

<style>
/* â”€â”€â”€â”€â”€â”€â”€â”€ CONNECT4 STYLES â”€â”€â”€â”€â”€â”€â”€â”€ */
.connect4-game{ text-align:center; margin-top:20px; }

.connect4-game .board{
  display:grid;
  grid-template-columns:repeat(7,1fr);
  gap:5px;
  max-width:600px;
  margin:auto;
}
.connect4-game .cell{
  background:#ffeb3b;          /* yellow board */
  border-radius:50%;
  width:80px; height:80px;
  position:relative;
  overflow:hidden;
  cursor:pointer;
  box-shadow:inset 0 0 5px rgba(0,0,0,.2);
}
.connect4-game .disc{
  background:currentColor;     /* color comes from the class */
  width:70%; height:70%;
  border-radius:50%;
  position:absolute;
  top:50%; left:50%;
  transform:translate(-50%,-150%);
  animation:dropDisc .5s ease-out forwards;
}
.connect4-game .disc.red{color:#e74c3c;}
.connect4-game .disc.blue{color:#3498db;}

@keyframes dropDisc{
  to{transform:translate(-50%,-50%);}
}

.connect4-game .highlight{
  box-shadow:0 0 15px #ffeb3b;
}
.connect4-game .message{
  font-weight:bold; font-size:1.8rem;
  margin-top:10px; min-height:2em;
}
.connect4-game .win,.connect4-game .draw{color:#e74c3c;}

.connect4-game button{
  padding:.5rem 1rem;
  background:#2c3e50;
  color:white;
  border:none;
  border-radius:4px;
  margin-top:10px;
}
.connect4-game button:hover{
  background:#d4af37; color:black;
}

</style>

<script>
/* â”€â”€â”€â”€â”€â”€â”€â”€ CONNECT4 MODULE â”€â”€â”€â”€â”€â”€â”€â”€ */
(() => {
  const container = document.querySelector('#connect4 .connect4-game');
  if (!container) return;

  const boardEl   = container.querySelector('.board');
  const messageEl = container.querySelector('.message');
  const resetBtn  = container.querySelector('.reset');

  const ROWS = 6, COLS = 7;
  let boardState;      // 2â€‘D array of colours or null
  let cells;           // cached DOM refs (2â€‘D)
  let currentPlayer;   // 'red' | 'blue'
  let gameOver;

  const init = () => {
    boardState = Array.from({ length: ROWS }, () =>
      Array(COLS).fill(null)
    );
    currentPlayer = 'red';
    gameOver     = false;
    setMessage(`${capitalize(currentPlayer)}'s turn`);

    // Build or clear the grid
    if (!cells) {                     // first run â€“ create cells
      cells = Array.from({ length: ROWS }, () => Array(COLS));
      const frag = document.createDocumentFragment();

      for (let r = 0; r < ROWS; r++) {
        for (let c = 0; c < COLS; c++) {
          const cell = document.createElement('div');
          cell.className   = 'cell';
          cell.dataset.row = r;
          cell.dataset.col = c;
          frag.appendChild(cell);
          cells[r][c] = cell;
        }
      }

      boardEl.innerHTML = '';
      boardEl.appendChild(frag);
    } else {                           // subsequent resets â€“ clear discs
      for (let r = 0; r < ROWS; r++) {
        for (let c = 0; c < COLS; c++) {
          const cell = cells[r][c];
          while (cell.firstChild) cell.removeChild(cell.firstChild);
        }
      }
    }
  };

  const dropDisc = col => {
    for (let r = ROWS - 1; r >= 0; r--) {
      if (!boardState[r][col]) {
        boardState[r][col] = currentPlayer;
        const disc = document.createElement('div');
        disc.className = `disc ${currentPlayer}`;
        cells[r][col].appendChild(disc);
        return true;
      }
    }
    return false; // column full
  };

  const checkWin = () => {
    const DIRS = [
      [0, 1],   // horizontal
      [1, 0],   // vertical
      [1, 1],   // diagonal downâ€‘right
      [1, -1]   // diagonal downâ€‘left
    ];

    for (let r = 0; r < ROWS; r++) {
      for (let c = 0; c < COLS; c++) {
        const p = boardState[r][c];
        if (!p) continue;

        for (const [dr, dc] of DIRS) {
          let count = 1;
          const pos   = [[r, c]];
          for (let i = 1; i < 4; i++) {
            const nr = r + dr * i,
                  nc = c + dc * i;
            if (
              nr >= 0 && nr < ROWS &&
              nc >= 0 && nc < COLS &&
              boardState[nr][nc] === p
            ) {
              count++;
              pos.push([nr, nc]);
            } else break;
          }
          if (count === 4) return { winner: p, positions: pos };
        }
      }
    }
    return null;
  };

  const isTie = () =>
    boardState.every(row => row.every(v => v !== null));

  const setMessage = (text, cls) => {
    messageEl.textContent = text;
    messageEl.className   = 'message';
    if (cls) messageEl.classList.add(cls);
  };

  boardEl.addEventListener('click', e => {
    if (gameOver) return;

    const cell = e.target.closest('.cell');
    if (!cell) return;

    const col = Number(cell.dataset.col);
    if (!dropDisc(col)) return;          // column full

    const win = checkWin();
    if (win) {
      gameOver = true;
      setMessage(`ðŸŽ‰ ${capitalize(win.winner)} Wins! ðŸŽ‰`, 'win');

      // highlight the winning discs
      win.positions.forEach(([r, c]) => {
        const discCell = cells[r][c];
        if (discCell.firstChild)
          discCell.firstChild.classList.add('highlight');
      });
    } else if (isTie()) {
      gameOver = true;
      setMessage("ðŸ’¥ It's a Draw! ðŸ’¥", 'draw');
    } else {
      currentPlayer = currentPlayer === 'red' ? 'blue' : 'red';
      setMessage(`${capitalize(currentPlayer)}'s turn`);
    }
  });

  resetBtn.addEventListener('click', init);

  const capitalize = s => s.charAt(0).toUpperCase() + s.slice(1);

  // initialise on page load
  document.addEventListener('DOMContentLoaded', init);
})();
</script>
